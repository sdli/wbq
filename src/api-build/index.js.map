{"version":3,"sources":["../api/index.js"],"names":["port","apiPort","app","use","secret","resave","saveUninitialized","cookie","maxAge","secure","urlencoded","extended","post","req","res","next","loginStart","getShopList","userId","session","loadAuth","body","shopname","type","startTime","endTime","getGoodsList","storesId","getOrderList","parseInt","getCashierList","json","reloadResponse","get","url","yunposServer","yunposPort","originalUrl","goods","orders","cashiers","code","startFetch","initFetch","listen"],"mappings":"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","file":"index.js","sourcesContent":["import \"babel-polyfill\";\r\nimport express from 'express';\r\nimport bodyParser from \"body-parser\";\r\nimport config from \"./utils/configs\";\r\nimport date from \"./utils/date\";\r\nconst  port = config.apiPort;\r\n\r\nimport session from \"express-session\";\r\nimport captchapng from 'captchapng';\r\nimport cookieParser from \"cookie-parser\";\r\nimport path from \"path\";\r\nimport apis from \"./lib\";\r\nimport co from 'co';\r\n\r\nconst app = new express();\r\napp.use(cookieParser());\r\n\r\napp.use(session({\r\n    secret: 'sessiontest',\r\n    resave: false,\r\n    saveUninitialized: false,\r\n    cookie: { maxAge: 1000 * 3600 * 24, secure: false }\r\n}));\r\n\r\napp.use(bodyParser.urlencoded({ extended: false }));\r\n\r\n//监听登录\r\napp.post('/login', function(req, res, next) { apis.loginStart(req, res); });\r\n\r\n//监听shoplist\r\napp.post(\"/getShopList\", function(req, res, next) { apis.getShopList(req, res,{userId:req.session.userId}); });\r\n\r\n//监听loadAuth\r\napp.post('/loadAuth', apis.loadAuth);\r\n\r\n//监听获取excel\r\napp.post('/getExcel', function(req, res, next) {\r\n    let { shopname, type, startTime, endTime } = req.body;\r\n    switch (type) {\r\n        case \"1\":\r\n            apis.getGoodsList(req, res, {storesId:shopname});\r\n            break;\r\n        case \"2\":\r\n            apis.getOrderList(req, res, {storesId:shopname, startTime: date(parseInt(startTime)), endTime:date(parseInt(endTime))});\r\n            break;\r\n        case \"3\":\r\n            apis.getCashierList(req, res, {storesId:shopname, startTime: date(parseInt(startTime)), endTime:date(parseInt(endTime))});\r\n            break;\r\n        default:\r\n            res.json(config.reloadResponse);\r\n    }\r\n});\r\n\r\napp.get(/file/,function(req,res,next){\r\n    let url = config.yunposServer+\":\"+config.yunposPort;\r\n    switch (req.originalUrl){\r\n        case \"/file/goods\":\r\n            url += req.session.goods;\r\n            break;\r\n        case \"/file/orders\":\r\n            url += req.session.orders;\r\n            break;\r\n        case \"/file/cashiers\":\r\n            url += req.session.cashiers;\r\n            break;\r\n        default:\r\n            res.json(\r\n                {code:0}\r\n            );\r\n    }\r\n    let startFetch = apis.initFetch(\"get\",url);\r\n    startFetch(req,res);\r\n});\r\n\r\napp.listen(port, apis.listen);"]}